<!DOCTYPE html> 
<html>
<head>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Forresst - Faire une liste jQuery Mobile triable par drag & drop</title>
  <meta name="author" content="forresst" />
  <!-- syntax highlighting CSS -->
  <link rel="stylesheet" href="/css/syntax.css" type="text/css" />
  <link rel="stylesheet" href="http://code.jquery.com/mobile/1.3.1/jquery.mobile-1.3.1.min.css" />
  <script src="http://code.jquery.com/jquery-1.9.1.min.js"></script>
  <script src="/js/jqm-init.js"></script>
  <script src="http://code.jquery.com/mobile/1.3.1/jquery.mobile-1.3.1.min.js"></script>
  <script src="http://code.jquery.com/ui/1.9.1/jquery-ui.min.js"></script>
  <script src="/js/jquery.ui.touch-punch.min.js"></script>
  <script>
  $(document).bind('pageinit', function() {
    $( "#sortable" ).sortable();
    $( "#sortable" ).disableSelection();
    $( "#sortable" ).bind( "sortstop", function(event, ui) {
      $('#sortable').listview('refresh');
    });
  });
  </script>
</head>
<body> 
<div data-role="page">
  <div data-role="header" data-position="fixed">
    <h1>Forresst's Blog</h1>
    <a href="#popupMenu" data-rel="popup" data-role="button" data-icon="gear" class="ui-btn-right" data-iconshadow="false">Menu</a>
    
    <div data-role="popup" id="popupMenu" data-theme="a">
        <ul data-role="listview" data-inset="true" style="min-width:210px;" data-theme="b">
          <li data-role="list-divider">Menu</li>
          <li><a href="/">Blog</a></li>
          <li><a href="/projet.html">Projet</a></li>
          <li><a href="/archives.html">Archives</a></li>
          <li><a href="/categories.html">Categories</a></li>
          <li><a href="/about.html">A propos</a></li>
        </ul>
    </div>

  </div><!-- /header -->

  <div data-role="content"><div id="post">
  <h2>Faire une liste jQuery Mobile triable par drag & drop</h2>
  <p>J'ai eu besoin d'une liste "triable" par drag &amp; drop sous jQuery Mobile qui fonctionne sur mon smartphone.
Ne voulant par réinventer la roue, j'ai piocher le code dans différentes librairies pour arriver à un résultat qui fonctionne sous Android 4 sur mon Nexus S avec le navigateur d'Android.
Vos retours sur d'autres smartphones, sur d'autres navigateurs m'interesse. Un petit retour sur mon compte twitter (@forresst17) sera apprécié. Je signalerais vos retours sur cet article.</p>

<p>Testé et approuvé sur :</p>

<ul>
<li><p>Nexus S avec Android 4.0 (mon smartphone)</p></li>
<li><p>iPad2 avec IOS 5.1 (Merci Poulpator)</p></li>
<li><p>Toshiba AT200 avec Android 4.0.3 (Merci zboub_2000)</p></li>
</ul>


<p>J'ai fait aussi des tests concluants sur plusieurs navigateurs de bureau :</p>

<ul>
<li><p>Chrome 12</p></li>
<li><p>Firefox 12 &amp; 13</p></li>
</ul>


<p>Voici le lien de la <a href="/demos/sortable/fr/index.html" rel="external" data-role="button" data-inline="true" data-mini="true">Démo</a>.</p>

<h3>1 - Créez une liste sous jQuery Mobile</h3>

<p>Tout d'abord nous allons créer une page jQuery Mobile contenant une liste :</p>

<div class="highlight"><pre><code class="html"><span class="cp">&lt;!DOCTYPE html&gt;</span> 
<span class="nt">&lt;html&gt;</span>
<span class="nt">&lt;head&gt;</span>
  <span class="nt">&lt;meta</span> <span class="na">http-equiv=</span><span class="s">&quot;content-type&quot;</span> <span class="na">content=</span><span class="s">&quot;text/html; charset=UTF-8&quot;</span><span class="nt">&gt;</span>
  <span class="nt">&lt;meta</span> <span class="na">charset=</span><span class="s">&quot;utf-8&quot;</span><span class="nt">&gt;</span>
  <span class="nt">&lt;meta</span> <span class="na">name=</span><span class="s">&quot;viewport&quot;</span> <span class="na">content=</span><span class="s">&quot;width=device-width, initial-scale=1&quot;</span><span class="nt">&gt;</span> 
  <span class="nt">&lt;title&gt;</span>Exemple<span class="nt">&lt;/title&gt;</span> 
  <span class="nt">&lt;link</span> <span class="na">rel=</span><span class="s">&quot;stylesheet&quot;</span> <span class="na">href=</span><span class="s">&quot;http://code.jquery.com/mobile/1.2.0/jquery.mobile-1.2.0.min.css&quot;</span> <span class="nt">/&gt;</span>
  <span class="nt">&lt;script </span><span class="na">src=</span><span class="s">&quot;http://code.jquery.com/jquery-1.8.2.min.js&quot;</span><span class="nt">&gt;&lt;/script&gt;</span>
  <span class="nt">&lt;script </span><span class="na">src=</span><span class="s">&quot;http://code.jquery.com/mobile/1.2.0/jquery.mobile-1.2.0.min.js&quot;</span><span class="nt">&gt;&lt;/script&gt;</span>
<span class="nt">&lt;/head&gt;</span>
<span class="nt">&lt;body&gt;</span> 
<span class="nt">&lt;div&gt;</span>
  <span class="nt">&lt;div</span> <span class="na">data-role=</span><span class="s">&quot;header&quot;</span> <span class="na">data-theme=</span><span class="s">&quot;d&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;h1&gt;</span>Exemple<span class="nt">&lt;/h1&gt;</span>
  <span class="nt">&lt;/div&gt;</span>

  <span class="nt">&lt;div</span> <span class="na">data-role=</span><span class="s">&quot;content&quot;</span> <span class="na">data-theme=</span><span class="s">&quot;c&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;ul</span> <span class="na">data-role=</span><span class="s">&quot;listview&quot;</span> <span class="na">data-inset=</span><span class="s">&quot;true&quot;</span> <span class="na">data-theme=</span><span class="s">&quot;d&quot;</span> <span class="na">id=</span><span class="s">&quot;sortable&quot;</span><span class="nt">&gt;</span>
      <span class="nt">&lt;li</span> <span class="na">data-role=</span><span class="s">&quot;list-divider&quot;</span><span class="nt">&gt;</span>Liste<span class="nt">&lt;/li&gt;</span>
      <span class="nt">&lt;li&gt;</span>Elément 1<span class="nt">&lt;/li&gt;</span>
      <span class="nt">&lt;li&gt;</span>Elément 2<span class="nt">&lt;/li&gt;</span>
      <span class="nt">&lt;li&gt;</span>Elément 3<span class="nt">&lt;/li&gt;</span>
      <span class="nt">&lt;li&gt;</span>Elément 4<span class="nt">&lt;/li&gt;</span>
      <span class="nt">&lt;li&gt;</span>Elément 5<span class="nt">&lt;/li&gt;</span>
    <span class="nt">&lt;/ul&gt;</span>
  <span class="nt">&lt;/div&gt;</span>
<span class="nt">&lt;/div&gt;</span>
<span class="nt">&lt;/body&gt;</span>
<span class="nt">&lt;/html&gt;</span>
</code></pre></div>


<p><strong>Remarque</strong> : j'ai rajouté <em>id="sortable"</em> sur la balise <em>ul</em>, cela va nous servir pour le point suivant.</p>

<h3>2 - Ajoutez les fonctionnalités sortable de jQuery UI</h3>

<p>Je me suis inspiré de la <a href="http://jqueryui.com/demos/sortable/" rel="external" data-role="button" data-inline="true" data-mini="true">Démo</a> du site de jQuery UI</p>

<div class="highlight"><pre><code class="html">...
  <span class="nt">&lt;title&gt;</span>Exemple<span class="nt">&lt;/title&gt;</span> 
  <span class="nt">&lt;link</span> <span class="na">rel=</span><span class="s">&quot;stylesheet&quot;</span> <span class="na">href=</span><span class="s">&quot;http://code.jquery.com/mobile/1.2.0/jquery.mobile-1.2.0.min.css&quot;</span> <span class="nt">/&gt;</span>
  <span class="nt">&lt;script </span><span class="na">src=</span><span class="s">&quot;http://code.jquery.com/jquery-1.8.2.min.js&quot;</span><span class="nt">&gt;&lt;/script&gt;</span>
  <span class="nt">&lt;script </span><span class="na">src=</span><span class="s">&quot;http://code.jquery.com/mobile/1.2.0/jquery.mobile-1.2.0.min.js&quot;</span><span class="nt">&gt;&lt;/script&gt;</span>
  
  <span class="c">&lt;!-- (Début) Ajoutez les fonctionnalités sortable de jQuery UI --&gt;</span>
  <span class="nt">&lt;script </span><span class="na">src=</span><span class="s">&quot;http://code.jquery.com/ui/1.8.24/jquery-ui.min.js&quot;</span><span class="nt">&gt;&lt;/script&gt;</span>
  <span class="nt">&lt;script&gt;</span>
  <span class="nx">$</span><span class="p">(</span><span class="nb">document</span><span class="p">).</span><span class="nx">bind</span><span class="p">(</span><span class="s1">&#39;pageinit&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="nx">$</span><span class="p">(</span> <span class="s2">&quot;#sortable&quot;</span> <span class="p">).</span><span class="nx">sortable</span><span class="p">();</span>
    <span class="nx">$</span><span class="p">(</span> <span class="s2">&quot;#sortable&quot;</span> <span class="p">).</span><span class="nx">disableSelection</span><span class="p">();</span>
    <span class="c">&lt;!--</span> <span class="nx">Refresh</span> <span class="nx">list</span> <span class="nx">to</span> <span class="nx">the</span> <span class="nx">end</span> <span class="nx">of</span> <span class="nx">sort</span> <span class="nx">to</span> <span class="nx">have</span> <span class="nx">a</span> <span class="nx">correct</span> <span class="nx">display</span> <span class="o">--&gt;</span>
    <span class="nx">$</span><span class="p">(</span> <span class="s2">&quot;#sortable&quot;</span> <span class="p">).</span><span class="nx">bind</span><span class="p">(</span> <span class="s2">&quot;sortstop&quot;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">event</span><span class="p">,</span> <span class="nx">ui</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;#sortable&#39;</span><span class="p">).</span><span class="nx">listview</span><span class="p">(</span><span class="s1">&#39;refresh&#39;</span><span class="p">);</span>
    <span class="p">});</span>
  <span class="p">});</span>
  <span class="nt">&lt;/script&gt;</span>
  <span class="c">&lt;!-- (Fin) Ajoutez les fonctionnalités sortable de jQuery UI --&gt;</span>
  
<span class="nt">&lt;/head&gt;</span>
<span class="nt">&lt;body&gt;</span> 
...
</code></pre></div>


<p><strong>Astuce</strong> : Si vous ne voulez pas utiliser la totalité de jQuery UI, vous pouvez récupérer sur la page de téléchargement de jQuery UI que les composants nécessaires pour notre exemple, c'est à dire :</p>

<ul>
<li>Core</li>
<li>Widget</li>
<li>Mouse</li>
<li>Sortable</li>
</ul>


<h3>3 - Ajoutez jQuery UI Touch Punch pour que cela fonctionne sur les appareils tactiles</h3>

<p>La liste triable fonctionne correctement sur un navigateur de bureau. Mais si vous voulez faire un test sur votre smartphone, cela ne fonctionne pas.
Il existe un petit plugin à jQuery UI qui permet de simuler les événements tactiles pour que le drag &amp; drop fonctionnent sur les smartphones.
Cet outil c'est <a href="http://touchpunch.furf.com/" rel="external" data-role="button" data-inline="true" data-mini="true">jQuery UI Touch Punch</a>.</p>

<p>Veuillez télécharger le <a href="https://raw.github.com/furf/jquery-ui-touch-punch/master/jquery.ui.touch-punch.min.js" rel="external" data-role="button" data-inline="true" data-mini="true">JS minifié</a> et le sauvegarder dans le même répertoire que votre fichier HTML. Puis ajoutez le JS dans votre page HTML.</p>

<div class="highlight"><pre><code class="html">...
  <span class="nt">&lt;script </span><span class="na">src=</span><span class="s">&quot;http://code.jquery.com/ui/1.8.24/jquery-ui.min.js&quot;</span><span class="nt">&gt;&lt;/script&gt;</span>

  <span class="c">&lt;!-- (Début) Ajoutez jQuery UI Touch Punch --&gt;</span>
  <span class="nt">&lt;script </span><span class="na">src=</span><span class="s">&quot;jquery.ui.touch-punch.min.js&quot;</span><span class="nt">&gt;&lt;/script&gt;</span>
  <span class="c">&lt;!-- (Fin) Ajoutez jQuery UI Touch Punch --&gt;</span>

  <span class="nt">&lt;script&gt;</span>
  $(document).bind(&#39;pageinit&#39;, function() {
    $( &quot;#sortable&quot; ).sortable();
...
</code></pre></div>


<p>La liste triable fonctionne maintenant correctement sur votre smartphone.</p>

<h3>4 - Conclusion</h3>

<p>J'espère que cela pourra vous servir dans vos futurs développements. Il faut bien être conscient que c'est une astuce et que ce n'est pas la meilleure solution qui existe.
Le fichier JS de jQuery UI est assez lourd, vous pouvez tout de même le diminuer en prenant seulement les composants cités au dessus.
Mais je pense que c'est la mise oeuvre la plus simple en attendant une autre solution ...</p>

</div>

<div class="whoring">
  <hr>
  <div id="disqus_thread"></div>
  <script type="text/javascript">
    /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
    var disqus_shortname = 'forresst'; // required: replace example with your forum shortname
    var disqus_identifier = 'Faire une liste jQuery Mobile triable par drag & drop';

    // The following are highly recommended additional parameters. Remove the slashes in front to use.
    // var disqus_identifier = 'unique_dynamic_id_1234';
    // var disqus_url = 'http://example.com/permalink-to-page.html';

    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function() {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = 'http://' + disqus_shortname + '.disqus.com/embed.js';
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
  </script>
  <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
  <a href="http://disqus.com" class="dsq-brlink">blog comments powered by <span class="logo-disqus">Disqus</span></a>
</div>
<div>
  <ul data-role="listview" data-inset="true" data-theme="d">
  <li data-role="list-divider">Articles recents</li>
  
    <li><a href="/2012/07/16/Comment-utiliser-jQueryMobile-et-Backbone-pour-gerer-des-formulaires/">16/07/2012 - Comment utiliser jQuery Mobile et Backbone.js pour gérer des formulaires</a></li>
  
    <li><a href="/2012/06/22/Make-a-list-jQuery-Mobile-sortable-by-drag-and-drop/">22/06/2012 - Make a list jQuery Mobile sortable by drag & drop</a></li>
  
    <li><a href="/2012/04/04/Depuis-une-Liste-vers-une-vue-detail-en-utilisant-jQueryMobile-et-Backbone/">04/04/2012 - Depuis une liste vers une vue détail en utilisant jQueryMobile et Backbone.js</a></li>
  
  </ul>
</div>
  </div><!-- /content -->

  <div data-role="footer" class="ui-bar">
    <div data-role="controlgroup" data-type="horizontal">
      <a href="https://github.com/forresst/forresst.github.com" data-role="button">Fork Me</a>
    </div>
  </div><!-- /footer -->

</div><!-- /page -->

</body>
</html>